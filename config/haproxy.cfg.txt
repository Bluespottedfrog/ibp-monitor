global
   log 127.0.0.1 local0
   chroot /var/lib/haproxy
   pidfile /var/run/haproxy.pid
   maxconn 250000
   user  haproxy
   group haproxy
   daemon
   nbthread 8
   server-state-base /opt/haproxy-2.6.6/etc/state/
   tune.bufsize 131072
   tune.ssl.default-dh-param 4096
   stats socket /var/run/haproxy.sock mode 600 level admin
   stats timeout 2m
   maxcompcpuusage 50

defaults
   log global
   retries 3
   # option http-use-htx
   maxconn 250000
   timeout connect 5s
   timeout client 300s
   timeout server 300s
   timeout queue 25s

####
#
# RELAYCHAIN CONFIGURATIONS
#
####
# Polkadot WSS configuration (for rpc nodes)

frontend relaychains-frontend
   bind *:443 ssl crt /etc/pki/certs
   mode http
   timeout client 300s

   # Web sockets
   acl wss hdr(Upgrade) -i websocket 

   # Relay chains
   acl polkadot path_beg -i /polkadot
   acl kusama path_beg -i /kusama
   acl westend path_beg -i /westend
   acl westmint path_beg -i /westmint
   acl statemine path_beg -i /statemine
   acl statemint path_beg -i /statemint

   # WSS Paths
   use_backend polkadot-wss-backend if polkadot wss
   use_backend kusama-wss-backend if kusama wss
   use_backend westend-wss-backend if westend wss
   use_backend westmint-wss-backend if westmint wss
   use_backend statemine-wss-backend if statemine wss
   use_backend statemint-wss-backend if statemint wss

   # RPC Paths
   use_backend polkadot-rpc-backend if polkadot !wss
   use_backend kusama-rpc-backend if kusama !wss
   use_backend westend-rpc-backend if westend !wss
   use_backend westmint-rpc-backend if westmint !wss
   use_backend statemine-rpc-backend if statemine !wss
   use_backend statemint-rpc-backend if statemint !wss


backend polkadot-rpc-backend
   mode http
   balance leastconn
   server polkadot-rpc-1 10.50.50.110:10000 check inter 2s maxconn 40
   server polkadot-rpc-2 10.50.50.111:11000 check inter 2s maxconn 40
   server polkadot-rpc-3 10.50.50.112:12000 check inter 2s maxconn 40
   server polkadot-rpc-4 10.50.50.113:13000 check inter 2s maxconn 40

backend polkadot-wss-backend
   mode http
   balance leastconn
   server polkadot-rpc-1 10.50.50.110:10001 check inter 2s maxconn 40
   server polkadot-rpc-2 10.50.50.111:11001 check inter 2s maxconn 40
   server polkadot-rpc-3 10.50.50.112:12001 check inter 2s maxconn 40
   server polkadot-rpc-4 10.50.50.113:13001 check inter 2s maxconn 40

backend kusama-rpc-backend
   mode http
   balance leastconn
   server kusama-rpc-1 10.50.50.120:10000 check inter 2s maxconn 40
   server kusama-rpc-2 10.50.50.121:11000 check inter 2s maxconn 40
   server kusama-rpc-3 10.50.50.122:12000 check inter 2s maxconn 40
   server kusama-rpc-4 10.50.50.123:13000 check inter 2s maxconn 40

backend kusama-wss-backend
   mode http
   balance leastconn
   server kusama-rpc-1 10.50.50.120:10001 check inter 2s maxconn 40
   server kusama-rpc-2 10.50.50.121:11001 check inter 2s maxconn 40
   server kusama-rpc-3 10.50.50.122:12001 check inter 2s maxconn 40
   server kusama-rpc-4 10.50.50.123:13001 check inter 2s maxconn 40

backend westend-rpc-backend
   mode http
   balance leastconn
   server westend-rpc-1 10.50.50.130:10000 check inter 2s maxconn 40
   server westend-rpc-2 10.50.50.131:11000 check inter 2s maxconn 40

backend westend-wss-backend
   mode http
   balance leastconn
   server westend-rpc-1 10.50.50.130:10001 check inter 2s maxconn 40
   server westend-rpc-2 10.50.50.131:11001 check inter 2s maxconn 40

backend westmint-rpc-backend
   mode http
   balance leastconn
   server westmint-rpc-1 10.50.50.140:10000 check inter 2s maxconn 40

backend westmint-wss-backend
   mode http
   balance leastconn
   server westmint-rpc-1 10.50.50.140:10001 check inter 2s maxconn 40

backend statemine-rpc-backend
   mode http
   balance leastconn
   server statemine-rpc-1 10.50.50.150:10000 check inter 2s maxconn 40

backend statemine-wss-backend
   mode http
   balance leastconn
   server statemine-rpc-1 10.50.50.150:10001 check inter 2s maxconn 40

backend statemint-rpc-backend
   mode http
   balance leastconn
   server statemint-rpc-1 10.50.50.160:10000 check inter 2s maxconn 40

backend statemint-wss-backend
   mode http
   balance leastconn
   server statemint-rpc-1 10.50.50.160:10001 check inter 2s maxconn 40

####
# END RELAYCHAIN CONFIGURATIONS
####